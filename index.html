<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>毛毛雷虎</title>
  <meta name="description" content="毛毛雷虎 - Twitch、YouTube、賣場+、Cover" />
  <meta property="og:title" content="毛毛雷虎" />
  <meta property="og:description" content="毛毛雷虎 - Twitch、YouTube、賣場+ 、Cover" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="https://i.imgur.com/2ZC3F2i.png" />
  <meta name="theme-color" content="#0ea5e9" />
  <style>
    :root {
      --bg: #0f172a;         
      --card: #111827;       
      --muted: #94a3b8;      
      --text: #e2e8f0;        
      --brand: #0ea5e9;    
      --border: rgba(148,163,184,.25);
      --radius: 18px;
      --maxw: 1100px;
    }
    @media (prefers-color-scheme: light) {
      :root { --bg:#f8fafc; --card:#ffffff; --text:#0f172a; --muted:#475569; --border: rgba(2,6,23,.1); }
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Noto Sans TC", "PingFang TC", "Microsoft JhengHei", sans-serif; background: var(--bg); color: var(--text); }

    .wrap { width: min(94vw, var(--maxw)); margin: 32px auto 56px; }
    .section { background: var(--card); border:1px solid var(--border); border-radius: 24px; padding: 24px; box-shadow: 0 10px 30px rgba(0,0,0,.25); }
    .gap { height: 18px; }

    .logoBox { display: grid; place-items: center; padding: 28px 20px; }
    .logo { width: 140px; height: 140px; border-radius: 50%; object-fit: cover; border: 4px solid rgba(255,255,255,.12); box-shadow: 0 6px 22px rgba(0,0,0,.25); }

    .linksRow { display: grid; grid-template-columns: 1fr; gap: 12px; }
    @media (min-width: 720px) { .linksRow { grid-template-columns: repeat(3, 1fr); } }
    .btn { display:flex; align-items:center; justify-content:center; gap:10px; padding: 14px 16px; border-radius: var(--radius); border:1px solid var(--border); background:#1f2937; color:#e5e7eb; text-decoration:none; font-weight:700; text-align:center; transition: transform .06s ease, background .2s ease; }
    .btn:hover { transform: translateY(-1px); background:#273446; }
    /* Icon buttons */
    .linksRow .btn.iconbtn { padding: 16px; }
    .icon { width: 22px; height: 22px; display: block; fill: currentColor; }
    /*     .sr-only {
      position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px;
      overflow: hidden; clip: rect(0,0,0,0); white-space: nowrap; border: 0;
    } */
    /* 品牌色（只影響 icon 顏色） */
    .iconbtn.-tw { color: #a970ff; }   /* Twitch 紫 */
    .iconbtn.-yt { color: #ff0033; }   /* YouTube 紅 */
    .iconbtn.-shop { color: #22c55e; } /* 賣場/購物 綠 */
    .linksRow .btn.iconbtn { padding: 16px; }
    .icon-img { width: 24px; height: 24px; display:block; }
    .sr-only {
      position:absolute; width:1px; height:1px; padding:0; margin:-1px;
      overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0;
    }


    
    .twoCol { display:grid; gap: 16px; }
    @media (min-width: 980px) { .twoCol { grid-template-columns: 1.2fr 1fr; } }
    .h2 { margin: 0 0 10px; font-size: clamp(18px, 2.4vw, 22px); letter-spacing:.5px; }

    .carousel { position: relative; }
    .track { display:flex; gap:12px; overflow-x:auto; scroll-snap-type:x proximity; padding-bottom: 6px; }
    .card { flex: 0 0 clamp(70%, 420px, 90%); scroll-snap-align:start; border:1px solid var(--border); background:#0b1220; border-radius: 16px; overflow: hidden; }
    @media (min-width: 720px) { .card { flex-basis: 60%; } }
    @media (min-width: 1100px) { .card { flex-basis: 48%; } }
    .thumb { position: relative; aspect-ratio: 16/9; width: 100%; background:#0a0f1c; display:block; }
    .thumb > img { width:100%; height:100%; object-fit: cover; display:block; }
    .meta { padding: 12px; }
    .title { font-size: 14px; line-height: 1.35; margin: 0 0 6px; }
    .meta small { color: var(--muted); }
    .navBtn { position:absolute; top: 42%; transform: translateY(-50%); border:1px solid var(--border); background: rgba(15,23,42,.6); color:#e5e7eb; width:36px; height:36px; border-radius:50%; display:grid; place-items:center; cursor:pointer; backdrop-filter: blur(6px); }
    .navPrev { left: -6px; } .navNext { right: -6px; }

    .ratio { position: relative; width: 100%; aspect-ratio: 16/9; background:#0b1220; border:1px solid var(--border); border-radius: 16px; overflow:hidden; }
    .ratio iframe { position:absolute; inset:0; width:100%; height:100%; border:0; }

    .grid3 { display:grid; grid-template-columns: 1fr; gap: 12px; }
    @media (min-width: 720px) { .grid3 { grid-template-columns: repeat(2, 1fr); } }
    @media (min-width: 1040px) { .grid3 { grid-template-columns: repeat(3, 1fr); } }
    .vcell { border:1px solid var(--border); border-radius: 16px; overflow:hidden; background:#0b1220; }
    .vcell .thumb { display:block; }
    .vcell .meta { padding: 10px 12px; }
    .more { display:flex; justify-content:center; margin-top:10px; }
    .footer { text-align:center; color: var(--muted); font-size: 12px; margin-top: 18px; }
  </style>
</head>
<body>
  <div class="wrap">
    <section class="section logoBox">
      <img class="logo" id="logo" src="https://avatars.githubusercontent.com/u/9919" alt="雷虎商店 Logo" />
    </section>
    <div class="gap"></div>
    <section class="section">
      <div class="linksRow">
        <!--         <a class="btn" href="https://www.twitch.tv/leihustore" target="_blank" rel="noopener">Twitch</a> -->
        <!--         <a class="btn" href="https://www.youtube.com/@leihustore" target="_blank" rel="noopener">YouTube</a> -->
        <!--         <a class="btn" href="https://famistore.famiport.com.tw/famistore/users/28555/malls/0100000000000000003ad1cd" target="_blank" rel="noopener">賣場＋</a> -->
        
        <!-- Twitch -->
        <a class="btn iconbtn" href="https://www.twitch.tv/leihustore" target="_blank" rel="noopener" aria-label="Twitch">
          <img class="icon-img" src="https://cdn.simpleicons.org/twitch/9146FF" alt="">
          <span class="sr-only">Twitch</span>
        </a>
    
        <!-- YouTube -->
        <a class="btn iconbtn" href="https://www.youtube.com/@leihustore" target="_blank" rel="noopener" aria-label="YouTube">
          <img class="icon-img" src="https://cdn.simpleicons.org/youtube/FF0000" alt="">
          <span class="sr-only">YouTube</span>
        </a>
    
        <!-- 賣場＋（非品牌，用購物袋 icon；顏色可自訂） -->
        <a class="btn iconbtn" href="https://famistore.famiport.com.tw/famistore/users/28555/malls/0100000000000000003ad1cd" target="_blank" rel="noopener" aria-label="賣場＋">
          <img class="icon-img" src="https://api.iconify.design/lucide:shopping-bag.svg?color=%2322c55e" alt="">
          <span class="sr-only">賣場＋</span>
        </a>
            
        
        <!--         <a class="btn iconbtn -tw" href="https://www.twitch.tv/leihustore" target="_blank" rel="noopener" aria-label="Twitch">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M4 3h16v11l-4 4h-4l-3 3v-3H6V3z"></path>
            <rect x="9" y="7" width="2" height="5"></rect>
            <rect x="13" y="7" width="2" height="5"></rect>
          </svg>
          <span class="sr-only">Twitch</span>
        </a>
        <a class="btn iconbtn -yt" href="https://www.youtube.com/@leihustore" target="_blank" rel="noopener" aria-label="YouTube">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
            <rect x="2" y="6" width="20" height="12" rx="3" ry="3"></rect>
            <polygon points="10,9 16,12 10,15"></polygon>
          </svg>
          <span class="sr-only">YouTube</span>
        </a>
        <a class="btn iconbtn -shop" href="https://famistore.famiport.com.tw/famistore/users/28555/malls/0100000000000000003ad1cd"
           target="_blank" rel="noopener" aria-label="賣場＋">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M3 4h2l1.6 8.4a2 2 0 0 0 2 1.6h8a2 2 0 0 0 2-1.6L20 7H6"></path>
            <circle cx="10" cy="19" r="1.5"></circle>
            <circle cx="16.5" cy="19" r="1.5"></circle>
          </svg>
          <span class="sr-only">賣場＋</span>
        </a> -->
      </div>
    </section>
    <div class="gap"></div>
    <section class="section twoCol">
      <div>
        <!--         <h2 class="h2">最新上傳</h2> -->
        <div class="carousel">
          <!--           <button class="navBtn navPrev" aria-label="上一張" title="上一張">◀</button> -->
          <div class="track" id="yt-track"></div>
          <!--           <button class="navBtn navNext" aria-label="下一張" title="下一張">▶</button> -->
        </div>
      </div>
      <div>
        <!--         <h2 class="h2">Twitch 直播</h2> -->
        <div class="ratio">
          <iframe id="twitchPlayer" allowfullscreen="true" scrolling="no" title="Twitch Player"></iframe>
        </div>
      </div>
    </section>
    <!-- <div class="gap"></div> -->
      <!--     <section class="section">  -->
      <!--       <h2 class="h2">更多影片</h2> -->
      <!--<div class="grid3" id="yt-grid"></div>-->
      <!--       <div class="footer">更新以最新上傳為主</div> -->
      <!--</section> -->
    <div class="gap"></div>
    <section class="section" id="pl-section">
      <!--       <h2 class="h2">播放清單</h2> -->
      <div class="grid3" id="pl-grid"></div>
      <div class="more"><button class="btn" id="pl-more" style="display:none">載入更多</button></div>
    </section>

    
    <!--     <div class="footer">© <span id="year"></span> 雷虎商店</div> -->
  </div>

  <script>
    // ======== 站點設定 ========
    const CONFIG = {
      logoUrl: '', // 可選：自訂 Logo URL（空字串保留預設）
      twitchChannel: 'leihustore',
      playlist: {
        id: 'PLTTobu2nJfiqhgaglxEILPgO7TRwGVmny', // 你的播放清單 ID
        pageSize: 9                                 // 每次載入 9 支（3x3）
      },
      youtube: {
        channelId: 'UCwpkJmj-DnvTkYK4uWPtkUA',
        apiKey: 'AIzaSyDg_P-BydTf3EROTR-yyLmDabjFXcKfwqg', 
        maxResults: 15,
        manualVideoIds: [
          'T9UcKMO3tKc','K9urc-JaKO8','4eYiLJh3dzg','0l1d1z2W19o','RZNY-lcLUrk','5gjwjCB1Y4E'
        ]
      }
    };

    // ======== 初始化靜態元素 ========
    if (CONFIG.logoUrl) {
      document.getElementById('logo').src = CONFIG.logoUrl;
    }
    // ==== 播放清單（每列 3 個；可分頁載入） ====
    async function fetchPlaylistPage(pageToken){
      const pl = CONFIG.playlist || {};
      const key = (CONFIG.youtube||{}).apiKey;
      if (!pl.id || !key) return { items: [], nextPageToken: null };
    
      const url = new URL('https://www.googleapis.com/youtube/v3/playlistItems');
      url.searchParams.set('key', key);
      url.searchParams.set('playlistId', pl.id);
      url.searchParams.set('part', 'snippet,contentDetails');
      url.searchParams.set('maxResults', String(Math.min(pl.pageSize||9, 50)));
      if (pageToken) url.searchParams.set('pageToken', pageToken);
    
      const res = await fetch(url);
      if (!res.ok) throw new Error('YouTube API 錯誤');
      const data = await res.json();
      const items = (data.items||[]).map(v => ({
        id: (v.contentDetails || v.snippet?.resourceId)?.videoId,
        title: v.snippet?.title || 'YouTube 影片'
      })).filter(x=>x.id);
      return { items, nextPageToken: data.nextPageToken || null };
    }
    // Twitch parent 需與當前網域一致
    (function initTwitch(){
      const parent = location.hostname || 'www.example.com';
      const src = new URL('https://player.twitch.tv/');
      src.searchParams.set('channel', CONFIG.twitchChannel);
      src.searchParams.set('parent', parent);
      src.searchParams.set('autoplay', 'false');
      src.searchParams.set('muted', 'true');
      document.getElementById('twitchPlayer').src = src.toString();
    })();

    // ======== 取得 YouTube 影片 ========
    async function fetchLatestVideoIds(){
      const { apiKey, channelId, maxResults, manualVideoIds } = CONFIG.youtube;
      // if (!apiKey) return manualVideoIds;
      if (!apiKey) {
        // 後備：用手動清單，補成 {id,title}
        return manualVideoIds.map(id => ({ id, title: '' }));
      }
      try {
        const url = new URL('https://www.googleapis.com/youtube/v3/search');
        url.searchParams.set('key', apiKey);
        url.searchParams.set('channelId', channelId);
        url.searchParams.set('part', 'snippet');
        url.searchParams.set('order', 'date');
        url.searchParams.set('type', 'video');
        url.searchParams.set('maxResults', String(maxResults));
        const res = await fetch(url);
        if (!res.ok) throw new Error('YouTube API 錯誤');
        const data = await res.json();
        // return data.items.map(v => v.id && v.id.videoId).filter(Boolean);
        return data.items
          .map(v => ({
            id: v.id && v.id.videoId,
            title: v.snippet?.title || ''
          }))
          .filter(v => !!v.id);
      } catch (err) {
        console.warn('[YouTube] 讀取失敗，改用手動清單', err);
        // return CONFIG.youtube.manualVideoIds;
        return CONFIG.youtube.manualVideoIds.map(id => ({ id, title: '' }));
      }
    }

    async function initPlaylistSection(){
      const sec  = document.getElementById('pl-section');
      const grid = document.getElementById('pl-grid');
      const more = document.getElementById('pl-more');
      const pl   = CONFIG.playlist || {};
      const key  = (CONFIG.youtube||{}).apiKey;
    
      // 若缺 id 或 key，就隱藏整塊
      if (!sec || !grid || !more || !pl.id || !key) {
        if (sec) sec.style.display = 'none';
        return;
      }
    
      let nextToken = null;
    
      async function load(){
        try {
          const { items, nextPageToken } = await fetchPlaylistPage(nextToken);
          items.forEach(({id, title}) => grid.appendChild(createGridCell(id, title)));
          nextToken = nextPageToken;
          more.style.display = nextToken ? 'inline-flex' : 'none';
        } catch (e) {
          console.warn('載入播放清單失敗', e);
          more.style.display = 'none';
        }
      }  
      more.addEventListener('click', load);
      // 首次載入 9 支（3x3）
      load();
    }

    
    function ytThumb(id){
      return `https://i.ytimg.com/vi/${id}/hqdefault.jpg`;
    }

    function createCard(id, title){
      const a = document.createElement('a');
      a.href = `https://www.youtube.com/watch?v=${id}`;
      a.target = '_blank';
      a.rel = 'noopener';
      a.className = 'card';
      a.innerHTML = `
        <span class="thumb"><img loading="lazy" src="${ytThumb(id)}" alt="${title || 'YouTube 影片'}" /></span>
        <div class="meta">
          <p class="title">${title || 'YouTube 影片'}</p>
        </div>`;
      return a;
    }

    function createGridCell(id, title){
      const a = document.createElement('a');
      a.href = `https://www.youtube.com/watch?v=${id}`;
      a.target = '_blank'; a.rel = 'noopener';
      a.className = 'vcell';
      a.innerHTML = `
        <span class="thumb"><img loading="lazy" src="${ytThumb(id)}" alt="${title || 'YouTube 影片'}" /></span>
        <div class="meta"><p class="title">${title || 'YouTube 影片'}</p></div>`;
      return a;
    }

    function bindCarouselNav(){
      const track = document.getElementById('yt-track');
      const prev = document.querySelector('.navPrev');
      const next = document.querySelector('.navNext');
      const step = () => track.clientWidth * 0.9;
      prev.addEventListener('click', () => track.scrollBy({ left: -step(), behavior: 'smooth' }));
      next.addEventListener('click', () => track.scrollBy({ left: step(), behavior: 'smooth' }));
    }

    async function init(){
      // const ids = await fetchLatestVideoIds();
      const videos = await fetchLatestVideoIds();
      const track = document.getElementById('yt-track');
      const grid = document.getElementById('yt-grid');

      // 前 4 個放在 Carousel（可自行調整數量）
      // const head = ids.slice(0, 4);
      // head.forEach(id => track.appendChild(createCard(id)));
      const head = videos.slice(0, 4);
      head.forEach(v => track.appendChild(createCard(v.id, v.title)));

      // 其餘放在 3 欄 Grid，自動換列
      // const rest = ids.slice(4);
      // rest.forEach(id => grid.appendChild(createGridCell(id)));
      const rest = videos.slice(4);
      rest.forEach(v => grid.appendChild(createGridCell(v.id, v.title)));

      bindCarouselNav();
    }

    init();
    initPlaylistSection();
  </script>
</body>
</html>
