<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>雷虎商店｜Link Hub</title>
  <meta name="description" content="雷虎商店 Link Hub：Twitch、YouTube、賣場+ 與最新影片" />
  <meta property="og:title" content="雷虎商店｜Link Hub" />
  <meta property="og:description" content="一頁聚合：Twitch、YouTube、賣場+ 與最新影片" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="https://i.imgur.com/2ZC3F2i.png" />
  <meta name="theme-color" content="#0ea5e9" />
  <style>
    :root {
      --bg: #0f172a;          /* 背景 */
      --card: #111827;        /* 卡片底 */
      --muted: #94a3b8;       /* 次要文字 */
      --text: #e2e8f0;        /* 主要文字 */
      --brand: #0ea5e9;       /* 主色 */
      --border: rgba(148,163,184,.25);
      --radius: 18px;
      --maxw: 1100px;
    }
    @media (prefers-color-scheme: light) {
      :root { --bg:#f8fafc; --card:#ffffff; --text:#0f172a; --muted:#475569; --border: rgba(2,6,23,.1); }
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Noto Sans TC", "PingFang TC", "Microsoft JhengHei", sans-serif; background: var(--bg); color: var(--text); }

    .wrap { width: min(94vw, var(--maxw)); margin: 32px auto 56px; }
    .section { background: var(--card); border:1px solid var(--border); border-radius: 24px; padding: 24px; box-shadow: 0 10px 30px rgba(0,0,0,.25); }
    .gap { height: 18px; }

    /* 頁首 Logo */
    .logoBox { display: grid; place-items: center; padding: 28px 20px; }
    .logo { width: 140px; height: 140px; border-radius: 50%; object-fit: cover; border: 4px solid rgba(255,255,255,.12); box-shadow: 0 6px 22px rgba(0,0,0,.25); }

    /* 主要連結按鈕 */
    .linksRow { display: grid; grid-template-columns: 1fr; gap: 12px; }
    @media (min-width: 720px) { .linksRow { grid-template-columns: repeat(3, 1fr); } }
    .btn { display:flex; align-items:center; justify-content:center; gap:10px; padding: 14px 16px; border-radius: var(--radius); border:1px solid var(--border); background:#1f2937; color:#e5e7eb; text-decoration:none; font-weight:700; text-align:center; transition: transform .06s ease, background .2s ease; }
    .btn:hover { transform: translateY(-1px); background:#273446; }

    /* 雙欄：左 YT 最新、右 Twitch */
    .twoCol { display:grid; gap: 16px; }
    @media (min-width: 980px) { .twoCol { grid-template-columns: 1.2fr 1fr; } }
    .h2 { margin: 0 0 10px; font-size: clamp(18px, 2.4vw, 22px); letter-spacing:.5px; }

    /* Carousel */
    .carousel { position: relative; }
    .track { display:flex; gap:12px; overflow-x:auto; scroll-snap-type:x proximity; padding-bottom: 6px; }
    .card { flex: 0 0 clamp(70%, 420px, 90%); scroll-snap-align:start; border:1px solid var(--border); background:#0b1220; border-radius: 16px; overflow: hidden; }
    @media (min-width: 720px) { .card { flex-basis: 60%; } }
    @media (min-width: 1100px) { .card { flex-basis: 48%; } }
    .thumb { position: relative; aspect-ratio: 16/9; width: 100%; background:#0a0f1c; display:block; }
    .thumb > img { width:100%; height:100%; object-fit: cover; display:block; }
    .meta { padding: 12px; }
    .title { font-size: 14px; line-height: 1.35; margin: 0 0 6px; }
    .meta small { color: var(--muted); }
    .navBtn { position:absolute; top: 42%; transform: translateY(-50%); border:1px solid var(--border); background: rgba(15,23,42,.6); color:#e5e7eb; width:36px; height:36px; border-radius:50%; display:grid; place-items:center; cursor:pointer; backdrop-filter: blur(6px); }
    .navPrev { left: -6px; } .navNext { right: -6px; }

    /* Twitch 16:9 容器 */
    .ratio { position: relative; width: 100%; aspect-ratio: 16/9; background:#0b1220; border:1px solid var(--border); border-radius: 16px; overflow:hidden; }
    .ratio iframe { position:absolute; inset:0; width:100%; height:100%; border:0; }

    /* 更多影片 Grid（每列 3 個，自動換列） */
    .grid3 { display:grid; grid-template-columns: 1fr; gap: 12px; }
    @media (min-width: 720px) { .grid3 { grid-template-columns: repeat(2, 1fr); } }
    @media (min-width: 1040px) { .grid3 { grid-template-columns: repeat(3, 1fr); } }
    .vcell { border:1px solid var(--border); border-radius: 16px; overflow:hidden; background:#0b1220; }
    .vcell .thumb { display:block; }
    .vcell .meta { padding: 10px 12px; }

    .footer { text-align:center; color: var(--muted); font-size: 12px; margin-top: 18px; }
    /* 播放清單區塊 */
    .plistSection { margin: 18px 0; }
    .plistHeader { display:flex; align-items:center; justify-content:space-between; margin: 0 0 10px; }
    .plistHeader .h2 { margin:0; }
    .more { display:flex; justify-content:center; margin-top: 10px; }
  </style>
</head>
<body>
  <div class="wrap">

    <!-- 1) Logo 區 -->
    <section class="section logoBox">
      <!-- TODO: 換成你的 Logo 連結 -->
      <img class="logo" id="logo" src="https://avatars.githubusercontent.com/u/9919" alt="雷虎商店 Logo" />
    </section>

    <div class="gap"></div>

    <!-- 2) 主要連結（Twitch / YouTube / 賣場+） -->
    <section class="section">
      <div class="linksRow">
        <a class="btn" href="https://www.twitch.tv/leihustore" target="_blank" rel="noopener">Twitch</a>
        <a class="btn" href="https://www.youtube.com/@leihustore" target="_blank" rel="noopener">YouTube</a>
        <a class="btn" href="https://famistore.famiport.com.tw/famistore/users/28555/malls/0100000000000000003ad1cd" target="_blank" rel="noopener">賣場＋</a>
      </div>
    </section>

    <div class="gap"></div>

    <!-- 3) 左右並排：左：YT 最新（左右滑動），右：Twitch Embed -->
    <section class="section twoCol">
      <div>
<!--         <h2 class="h2">最新上傳</h2> -->
        <div class="carousel">
          <button class="navBtn navPrev" aria-label="上一張" title="上一張">◀</button>
          <div class="track" id="yt-track"></div>
          <button class="navBtn navNext" aria-label="下一張" title="下一張">▶</button>
        </div>
      </div>
      <div>
<!--         <h2 class="h2">Twitch 直播</h2> -->
        <div class="ratio">
          <!-- 以 JS 動態帶入 parent= 目前網域，避免手動改域名 -->
          <iframe id="twitchPlayer" allowfullscreen="true" scrolling="no" title="Twitch Player"></iframe>
        </div>
      </div>
    </section>

    <div class="gap"></div>

    <!-- 4) 更多影片（每列 3 個，自動換列） -->
    <!-- 4) 播放清單（每列 3 個，自動換列；可多清單） -->
<div id="playlist-root"></div>

      <!--     <div class="footer">© <span id="year"></span> 雷虎商店</div> -->
  </div>

  <script>
    // ======== 站點設定 ========
    const CONFIG = {
      logoUrl: '', // 可選：自訂 Logo URL（空字串保留預設）
      twitchChannel: 'leihustore',
      youtube: {
        channelId: 'UCwpkJmj-DnvTkYK4uWPtkUA',
        apiKey: 'AIzaSyDg_P-BydTf3EROTR-yyLmDabjFXcKfwqg', // 你的 YouTube Data API key（建議用 HTTP referrer 限制）
        maxResults: 15,
        manualVideoIds: [ 'T9UcKMO3tKc','K9urc-JaKO8','4eYiLJh3dzg','0l1d1z2W19o','RZNY-lcLUrk','5gjwjCB1Y4E' ]
      },
      // ▶ 依照播放清單顯示（每列 3 個，自動換列）。請把 playlistId 換成你的。
      playlists: [
        { title: '最新播放清單', playlistId: 'PLTTobu2nJfiqhgaglxEILPgO7TRwGVmny', max: 9 }
      ]
    };

    // ======== 初始化靜態元素 ========
    document.getElementById('year').textContent = new Date().getFullYear();
    if (CONFIG.logoUrl) {
      document.getElementById('logo').src = CONFIG.logoUrl;
    }

    // Twitch parent 需與當前網域一致
    (function initTwitch(){
      const parent = location.hostname || 'www.example.com';
      const src = new URL('https://player.twitch.tv/');
      src.searchParams.set('channel', CONFIG.twitchChannel);
      src.searchParams.set('parent', parent);
      src.searchParams.set('autoplay', 'false');
      src.searchParams.set('muted', 'true');
      document.getElementById('twitchPlayer').src = src.toString();
    })();

    // ======== 取得 YouTube 影片（最新 / 播放清單） ========
    async function fetchLatestVideoIds(){
      const { apiKey, channelId, maxResults, manualVideoIds } = CONFIG.youtube;
      if (!apiKey) return manualVideoIds; // 無 Key 就用手動清單
      try {
        // 省額度：用上傳清單 playlistItems（1 quota/次）
        const uploads = 'UU' + channelId.slice(2);
        const url = new URL('https://www.googleapis.com/youtube/v3/playlistItems');
        url.searchParams.set('key', apiKey);
        url.searchParams.set('playlistId', uploads);
        url.searchParams.set('part', 'snippet,contentDetails');
        url.searchParams.set('maxResults', String(Math.min(maxResults, 50)));
        const res = await fetch(url);
        if (!res.ok) throw new Error('YouTube API 錯誤');
        const data = await res.json();
        return data.items
          .map(v => (v.contentDetails || v.snippet?.resourceId)?.videoId)
          .filter(Boolean);
      } catch (err) {
        console.warn('[YouTube] 讀取失敗，改用手動清單', err);
        return CONFIG.youtube.manualVideoIds;
      }
    }

    // 讀取單一播放清單（支援分頁）
    async function fetchPlaylistPage(playlistId, pageToken, limit){
      const { apiKey } = CONFIG.youtube;
      if (!apiKey) return { items: [], nextPageToken: null };
      const url = new URL('https://www.googleapis.com/youtube/v3/playlistItems');
      url.searchParams.set('key', apiKey);
      url.searchParams.set('playlistId', playlistId);
      url.searchParams.set('part', 'snippet,contentDetails');
      url.searchParams.set('maxResults', String(Math.min(limit || 9, 50)));
      if (pageToken) url.searchParams.set('pageToken', pageToken);
      const res = await fetch(url);
      if (!res.ok) throw new Error('YouTube API 錯誤');
      const data = await res.json();
      const items = (data.items||[]).map(v => ({
        id: (v.contentDetails || v.snippet?.resourceId)?.videoId,
        title: v.snippet?.title || 'YouTube 影片'
      })).filter(x => !!x.id);
      return { items, nextPageToken: data.nextPageToken || null };
    }

    function ytThumb(id){
      return `https://i.ytimg.com/vi/${id}/hqdefault.jpg`;
    }

    function createCard(id, title){
      const a = document.createElement('a');
      a.href = `https://www.youtube.com/watch?v=${id}`;
      a.target = '_blank';
      a.rel = 'noopener';
      a.className = 'card';
      a.innerHTML = `
        <span class="thumb"><img loading="lazy" src="${ytThumb(id)}" alt="${title || 'YouTube 影片'}" /></span>
        <div class="meta">
          <p class="title">${title || 'YouTube 影片'}</p>
          <small>點擊前往 YouTube</small>
        </div>`;
      return a;
    }

    function createGridCell(id, title){
      const a = document.createElement('a');
      a.href = `https://www.youtube.com/watch?v=${id}`;
      a.target = '_blank'; a.rel = 'noopener';
      a.className = 'vcell';
      a.innerHTML = `
        <span class="thumb"><img loading="lazy" src="${ytThumb(id)}" alt="${title || 'YouTube 影片'}" /></span>
        <div class="meta"><p class="title">${title || 'YouTube 影片'}</p></div>`;
      return a;
    }

    function bindCarouselNav(){
      const track = document.getElementById('yt-track');
      const prev = document.querySelector('.navPrev');
      const next = document.querySelector('.navNext');
      const step = () => track.clientWidth * 0.9;
      prev.addEventListener('click', () => track.scrollBy({ left: -step(), behavior: 'smooth' }));
      next.addEventListener('click', () => track.scrollBy({ left: step(), behavior: 'smooth' }));
    }

    async function init(){
      const ids = await fetchLatestVideoIds();
      const track = document.getElementById('yt-track');
      const grid = document.getElementById('yt-grid');

      // 前 4 個放在 Carousel（可自行調整數量）
      const head = ids.slice(0, 4);
      head.forEach(id => track.appendChild(createCard(id)));

      // 舊版：其餘放在 3 欄 Grid（若仍保留 #yt-grid 就渲染，否則略過）
      if (grid) {
        const rest = ids.slice(4);
        rest.forEach(id => grid.appendChild(createGridCell(id)));
      }

      bindCarouselNav();

      // ▶ 播放清單渲染（每清單一個區塊、每列3個）
      initPlaylists();
    }

    init();

    // ======== 播放清單渲染（每列 3 個；可多清單） ========
    function createPlaylistSection({ title, playlistId }){
      const section = document.createElement('section');
      section.className = 'section plistSection';
      const header = document.createElement('div');
      header.className = 'plistHeader';
      const h = document.createElement('h2');
      h.className = 'h2'; h.textContent = title || '播放清單';
      header.appendChild(h);
      section.appendChild(header);

      const grid = document.createElement('div');
      grid.className = 'grid3';
      section.appendChild(grid);

      const moreBox = document.createElement('div');
      moreBox.className = 'more';
      const moreBtn = document.createElement('button');
      moreBtn.className = 'btn';
      moreBtn.textContent = '載入更多';
      moreBox.appendChild(moreBtn);
      section.appendChild(moreBox);

      section._grid = grid;
      section._moreBtn = moreBtn;
      section._playlistId = playlistId;
      section._nextToken = null;
      return section;
    }

    async function loadPlaylistChunk(section, maxAppend = 9){
      const { items, nextPageToken } = await fetchPlaylistPage(section._playlistId, section._nextToken, maxAppend);
      items.forEach(({id, title}) => section._grid.appendChild(createGridCell(id, title)));
      section._nextToken = nextPageToken;
      section._moreBtn.style.display = nextPageToken ? 'inline-flex' : 'none';
    }

    function initPlaylists(){
      const root = document.getElementById('playlist-root');
      if (!root || !Array.isArray(CONFIG.playlists) || CONFIG.playlists.length === 0) return;
      CONFIG.playlists.forEach(pl => {
        const section = createPlaylistSection(pl);
        root.appendChild(section);
        // 初次載入 9 個（3x3），之後按鈕再載更多
        loadPlaylistChunk(section, pl.max || 9);
        section._moreBtn.addEventListener('click', () => loadPlaylistChunk(section, pl.max || 9));
      });
    }
  </script>
</body>
</html>
